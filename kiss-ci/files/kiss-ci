#!/usr/bin/env bash
# Build a package in a container

if [ $# -lt 1 ]; then
  echo "please provide at least one package to build" >&2
  exit 1
fi
version=2020.9-2
containerfile_uri="https://git.sr.ht/~armaan/dockerfiles/blob/32f35a1682186934a66f42163719d6958676cbca/kiss/2020.9-2/Dockerfile"
containerfile=${XDG_CACHE_HOME:-$HOME/.cache}/kiss-ci-containerfile
test -f "$containerfile" || curl -s "$containerfile_uri" -o "$containerfile"

imageid=$(podman image list kiss:$version)
test -n "$imageid" || podman build -t $version -f "$containerfile"
podman run --volume $PWD:/root/.cache/kiss/bin kiss kiss build $@
